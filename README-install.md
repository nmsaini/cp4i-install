# cp4i fresh install

Refer to [2022.2.1 docs](https://www.ibm.com/docs/en/cloud-paks/cp-integration/2022.2?topic=images-adding-catalog-sources-cluster)

## Step 1. Install ibm-pak plugin to ocp
```
./install-ibm-pak-plugin.sh
```

## Step 2. Generate your operator manifest files
The catalog text file contains the operator versions valid for 2022.2 LTS release as of today. If you want a different release please make sure your catalog.txt file is updated with your versions! 
If there are newer versions that are valid for the current 2022.2 LTS then please update the versions in this file before running the command.
```
./gen-operator-catalog.sh catalog.2022.2.txt
```
You will need to apply the catalog-sources yaml that is generated by the above script from your **own output**.
üõë DO NOT COPY this output. This is just a sample. You need to copy from your own execution output!
```
******************************************************************
********** apply the following operator manifests ****************
******************************************************************
oc apply -f /root/.ibm-pak/data/mirror/ibm-integration-platform-navigator/1.7.11/catalog-sources.yaml
oc apply -f /root/.ibm-pak/data/mirror/ibm-integration-asset-repository/1.5.10/catalog-sources-linux-amd64.yaml
oc apply -f /root/.ibm-pak/data/mirror/ibm-integration-operations-dashboard/2.6.12/catalog-sources-linux-amd64.yaml
oc apply -f /root/.ibm-pak/data/mirror/ibm-apiconnect/4.0.4/catalog-sources.yaml
oc apply -f /root/.ibm-pak/data/mirror/ibm-apiconnect/4.0.4/catalog-sources-linux-amd64.yaml
oc apply -f /root/.ibm-pak/data/mirror/ibm-appconnect/5.0.8/catalog-sources.yaml
oc apply -f /root/.ibm-pak/data/mirror/ibm-mq/2.0.12/catalog-sources.yaml
oc apply -f /root/.ibm-pak/data/mirror/ibm-eventstreams/3.2.1/catalog-sources.yaml
oc apply -f /root/.ibm-pak/data/mirror/ibm-datapower-operator/1.6.8/catalog-sources-linux-amd64.yaml
oc apply -f /root/.ibm-pak/data/mirror/ibm-aspera-hsts-operator/1.5.9/catalog-sources.yaml
******************************************************************
```
validate the new catalog sources.
```
oc -n openshift-marketplace get catalogsources
```

## Step 3. Create a subsciption for your operators
if doing namespaced scope
```
export NS=cp4i-dev
./gen-subscription-plan.sh subscription-channels.txt
```

if doing global make 
```
export NS=openshift-operators
./gen-subscription-plan.sh subscription-channels.txt
```
‚ùóSubscription channel text file contains the versions of the channels available for a release.
This file currently contains versions for the 2022.2 LTS release. If you need a different release either update this file with those versions or create a new file and use that file instead in the command above.

## Step 4. create a pull secret
create your pull secret either in the global pull-secret or in the namespace
```
oc create secret docker-registry ibm-entitlement-key \
    --docker-username=cp \
    --docker-password=$KEY \
    --docker-server=cp.icr.io \
    --namespace=$NS
```

For global pull-secret, you need to extract the current config and then update the dockerconfigjson as 
```
oc extract secret/pull-secret -n openshift-config --keys=.dockerconfigjson --to . --confirm
oc registry login --registry=cp.icr.io --auth-basic="cp:$KEY" --to .dockerconfigjson
oc set data secret/pull-secret -n openshift-config --from-file=.dockerconfigjson=.dockerconfigjson
```

## Step 5. Validate before creating operands
Validate your subscriptions are healthy
